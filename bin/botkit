#!/bin/bash

function on_cd() {
    #
    # Project file
    #
    if [[ -r ${PWD}/.botkit/projectrc ]]; then
        source .projectrc
    fi
}

function cmd_init() {
    if [[ ! -d .botkit ]]; then
        set -B
        mkdir .botkit
        mkdir .botkit/{workflows,secrets,runs,files,app,test,bin}
        touch .botkit/projectrc
        touch .botkit/botkitrc
    fi
}

function cmd_cicd_init() {
    if [[ ! -d ${PWD}/.github ]]; then
        mkdir .github
        mkdir -p .github/workflows
    fi
}

function bot() {
    printf "$#\n"
    printf "$@\n"

    while [[ $# -ge 1 ]] ; do 
        case $1 in
            init)
                cmd_init
                shift
                ;;
            *)
                shift
                ;;
        esac
    done
}

export BOTKIT_CICD_SYSTEM=${BOTKIT_CICD_SYSTEM:-github}
export PROMPT_COMMAND='on_cd'

#  gh run list -w "debug.yaml" -L 1 --json databaseId --jq '.[0].databaseId'

# gh workflow run --ref botkit/v1.0.0 .github/workflows/debug.yaml

#  gh run view 12257765368 --log
